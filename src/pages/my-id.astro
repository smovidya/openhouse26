---
import MyIdHeader from "@src/assets/my-id-header.png";
import QrId from "@src/components/qr-id.svelte";
import { getParticipantByUserId } from "@src/db/model/participant";
import { Image } from "astro:assets";
import Layout from "../layouts/ContentLayout.astro";

const uid = Astro.locals.user?.id;
if (!uid) {
  return Astro.redirect("/");
}

const participant = await getParticipantByUserId(Astro.locals.db, uid);
if (!participant) {
  return Astro.redirect("/");
}

const id = participant.id;
const name = participant.givenName;
---

<Layout
  title="หน้าหลัก"
  description="งาน Open House คณะวิทยาศาสตร์ จุฬาลงกรณ์มหาวิทยาลัย 2566"
  image="/og-image.png"
>
  <!-- TODO: nav -->

  <main class="font-serif text-sm relative">
    <!-- TODO: resize this -->
    <Image
      src={MyIdHeader}
      alt="MyId"
      class="w-screen relative z-3 max-w-100 mx-auto"
    />
    <section
      class="bg-[#FBB84B] rounded-xl max-w-78 shadow-lg shadow-black/40 mt-7 mx-auto flex flex-col"
    >
      <div>
        <div class="relative flex flex-col items-center">
          <div class="back-strap absolute bottom-7 ml-9"></div>
          <div id="yellow-fill" class="absolute top-0 bg-[#FBB84B] h-4 w-23">
          </div>
          <div class="front-strap absolute bottom-7 mr-9"></div>

          <div
            class="z-2 mx-auto h-6 my-4 w-23 bg-[#324a89] rounded-full shadow-inner shadow-black/50"
          >
          </div>
        </div>
        <p class="leading-5 text-center px-2 pb-1 text-amber-900/60">
          สามารถกดค้างที่ QR เพื่อบันทึกลงในอุปกรณ์ได้
        </p>
      </div>
      <div
        class="flex flex-col items-center p-10 pb-3 qr-bg shadow-lg shadow-black/20"
      >
        <div
          class="aspect-square w-48 bg-[#3d4458] border border-slate-500 rounded-md shadow-inner shadow-black/40 text-white overflow-clip"
        >
          <QrId client:load content={id ?? "not-loggedin"} />
        </div>
        <h3 class="text-xl mt-2 font-medium text-white">{name}</h3>
        <h3 class="font-medium text-slate-400">ID: {id}</h3>
      </div>
      <div class="p-6">
        <!-- <button
          class="block text-center mx-auto py-2 rounded-lg w-48 bg-red-50"
        >
          แก้ไขข้อมูล
        </button> -->
      </div>
    </section>
  </main>

  <section class="text-blue-200 font-serif text-sm mt-12">
    <h2 class="text-xl text-white text-center font-sans">
      เงื่อนไขการลงทะเบียนเวิร์กช็อป
    </h2>
    <ol class="list-decimal pl-4 mt-2">
      <li>
        ผู้เข้าร่วมสามารถเลือกได้สูงสุด 2 รอบ
        <span class="text-amber-300">
          *แต่ต้องเป็นคนละภาควิชา ห้ามลงภาควิชาเดิมซ้ำ*
        </span>
      </li>
      <li>
        ไม่สามารถลง Workshop ที่เวลาติดกันทันทีได้ ต้องเว้นอย่างน้อย 60 นาที
      </li>
      <li>
        ผู้เข้าร่วมสามารถลงทะเบียนก่อนเริ่มกิจกรรม 15 นาที
        และลงทะเบียนที่บูทของรอบนั้นโดยใช้ระยะเวลาลงทะเบียน 10 นาที <br />
        <span class="font-bold text-blue-50">ตัวอย่าง</span> รอบ 9:00 น. ต้องลงทะเบียนระหว่าง
        8:45 - 8.55 น. เท่านั้น
      </li>
    </ol>
  </section>

  <section class="mt-8 text-sm text-blue-300/85 font-serif">
    <h2 class="text-2xl text-white">My workshops</h2>
    <div class="flex justify-between text-md">
      <span> เวิร์กช็อปที่ลงทะเบียนแล้ว (2/3) </span>
      <a href="" class="underline underline-offset-2">ดูทั้งหมด →</a>
    </div>
  </section>
</Layout>

<style>
  .front-strap {
    width: 2.5rem;
    height: 6rem;
    transform: rotate(-22deg);
    background-color: rgb(182, 222, 233);
  }

  .back-strap {
    width: 2.5rem;
    height: 6rem;
    transform: rotate(22deg);
    background-color: rgb(139, 171, 181);
  }

  .qr-bg {
    background: linear-gradient(
      182deg,
      #222a40 1.58%,
      #394766 36.96%,
      #566b9a 49.07%,
      #394766 63.04%,
      #222a40 98.42%
    );
  }
</style>
