---
import MyIdHeader from "@src/assets/my-id-header.png";
import QrId from "@src/components/qr-id.svelte";
import { getParticipantByUserId } from "@src/db/model/participant";
import { Image } from "astro:assets";
import Layout from "../layouts/ContentLayout.astro";
import { workshopRegistrationDate } from "@src/data/constants";
import Countdown from "@src/components/countdown.svelte"

const uid = Astro.locals.user?.id;
if (!uid) {
  return Astro.redirect("/");
}

const participant = await getParticipantByUserId(Astro.locals.db, uid);
if (!participant) {
  return Astro.redirect("/register");
}

const id = participant.id;
const name = participant.givenName;

workshopRegistrationDate;
---

<Layout
  title="‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å"
  description="‡∏á‡∏≤‡∏ô Open House ‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå ‡∏à‡∏∏‡∏¨‡∏≤‡∏•‡∏á‡∏Å‡∏£‡∏ì‡πå‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢ 2566"
  image="/og-image.png"
>
  <!-- TODO: nav -->

  <main class="font-serif text-sm relative">
    <!-- TODO: resize this -->
    <Image
      src={MyIdHeader}
      alt="MyId"
      class="w-screen relative z-3 max-w-100 mx-auto"
    />
    <section
      class="bg-[#FBB84B] rounded-xl max-w-78 shadow-lg shadow-black/40 mt-7 mx-auto flex flex-col"
    >
      <div>
        <div class="relative flex flex-col items-center">
          <div class="back-strap absolute bottom-7 ml-9"></div>
          <div id="yellow-fill" class="absolute top-0 bg-[#FBB84B] h-4 w-23">
          </div>
          <div class="front-strap absolute bottom-7 mr-9"></div>

          <div
            class="z-2 mx-auto h-6 my-4 w-23 bg-[#324a89] rounded-full shadow-inner shadow-black/50"
          >
          </div>
        </div>
        <p class="leading-5 text-center px-2 pb-1 text-amber-900/60">
          ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà QR ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡πÉ‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÑ‡∏î‡πâ
        </p>
      </div>
      <div
        class="flex flex-col items-center p-10 pb-3 qr-bg shadow-lg shadow-black/20"
      >
        <div
          class="aspect-square w-48 bg-[#3d4458] border border-slate-500 rounded-md shadow-inner shadow-black/40 text-white overflow-clip"
        >
          <QrId client:load content={id ?? "not-loggedin"} />
        </div>
        <h3 class="text-xl mt-2 font-medium text-white">{name}</h3>
        <h3 class="font-medium text-slate-400">ID: {id}</h3>
      </div>
      <div class="p-6">
        <!-- <button
          class="block text-center mx-auto py-2 rounded-lg w-48 bg-red-50"
        >
          ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        </button> -->
      </div>
    </section>
  </main>

  <section class="text-blue-200 font-serif text-sm mt-12">
    <h2 class="text-xl text-white text-center font-sans">
      ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏Å‡∏ä‡πá‡∏≠‡∏õ
    </h2>
    <ol class="list-decimal pl-4 mt-2">
      <li>
        ‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 2 ‡∏£‡∏≠‡∏ö
        <span class="text-amber-300">
          *‡πÅ‡∏ï‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡∏•‡∏∞‡∏†‡∏≤‡∏Ñ‡∏ß‡∏¥‡∏ä‡∏≤ ‡∏´‡πâ‡∏≤‡∏°‡∏•‡∏á‡∏†‡∏≤‡∏Ñ‡∏ß‡∏¥‡∏ä‡∏≤‡πÄ‡∏î‡∏¥‡∏°‡∏ã‡πâ‡∏≥*
        </span>
      </li>
      <li>
        ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏á Workshop ‡∏ó‡∏µ‡πà‡πÄ‡∏ß‡∏•‡∏≤‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÑ‡∏î‡πâ ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ß‡πâ‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 60 ‡∏ô‡∏≤‡∏ó‡∏µ
      </li>
      <li>
        ‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° 15 ‡∏ô‡∏≤‡∏ó‡∏µ
        ‡πÅ‡∏•‡∏∞‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏π‡∏ó‡∏Ç‡∏≠‡∏á‡∏£‡∏≠‡∏ö‡∏ô‡∏±‡πâ‡∏ô‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô 10 ‡∏ô‡∏≤‡∏ó‡∏µ <br />
        <span class="font-bold text-blue-50">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</span> ‡∏£‡∏≠‡∏ö 9:00 ‡∏ô. ‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á
        8:45 - 8.55 ‡∏ô. ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
      </li>
    </ol>
  </section>

  <!-- <section class="mt-8 text-sm text-blue-300/85 font-serif">
    <h2 class="text-2xl text-white">My workshops</h2>
    <div class="flex justify-between text-md">
      <span> ‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏Å‡∏ä‡πá‡∏≠‡∏õ‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß (2/3) </span>
      <a href="" class="underline underline-offset-2">‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‚Üí</a>
    </div>
  </section> -->

  <section class="text-white mt-6 text-center text-md">
    <h3>üîí ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏Å‡∏ä‡πá‡∏≠‡∏õ‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 6 ‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏° ‡πÄ‡∏ß‡∏•‡∏≤ 09:00 ‡∏ô.</h3>
    <!-- <Countdown client:load to={workshopRegistrationDate.getTime()} /> -->
  </section>
</Layout>

<style>
  .front-strap {
    width: 2.5rem;
    height: 6rem;
    transform: rotate(-22deg);
    background-color: rgb(182, 222, 233);
  }

  .back-strap {
    width: 2.5rem;
    height: 6rem;
    transform: rotate(22deg);
    background-color: rgb(139, 171, 181);
  }

  .qr-bg {
    background: linear-gradient(
      182deg,
      #222a40 1.58%,
      #394766 36.96%,
      #566b9a 49.07%,
      #394766 63.04%,
      #222a40 98.42%
    );
  }
</style>
